# K6 性能测试框架

## 项目概述

这是一个基于K6的性能测试框架，用于执行Web应用的负载测试、压力测试和峰值测试。该框架提供了一套完整的测试场景和可配置的性能指标，帮助开发团队评估和优化系统性能。

## 目录结构

```
├── config/
│   └── config.js          # 测试配置文件
├── tests/
│   ├── load-test.js       # 负载测试脚本
│   ├── stress-test.js     # 压力测试脚本
│   └── spike-test.js      # 峰值测试脚本
├── utils/
│   └── http.js           # HTTP客户端工具
└── package.json          # 项目配置文件
```

## 测试场景说明

### 1. 负载测试 (Load Test)

模拟正常负载下的系统性能，包含以下测试场景：
- 帖子管理：查看和创建帖子
- 评论管理：查看和发表评论
- 相册管理：浏览相册和照片
- 待办事项：增删改查操作

运行命令：`npm run test:load`

### 2. 压力测试 (Stress Test)

测试系统在高负载下的性能表现，包含：
- 帖子浏览和详情查看
- 评论列表查询和创建
- 相册和照片批量访问

运行命令：`npm run test:stress`

### 3. 峰值测试 (Spike Test)

模拟突发流量场景，测试包括：
- 首页快速访问
- 商品搜索并发
- 用户信息批量查询
- 订单快速创建

运行命令：`npm run test:spike`

## 配置说明

### 性能测试参数配置

在 `config/config.js` 中可以配置：

1. 基础URL配置
```javascript
baseUrl: 'https://jsonplaceholder.typicode.com'
```

2. 测试阶段配置
- 负载测试：渐进式增加用户数
- 压力测试：快速增加并保持高负载
- 峰值测试：模拟突发流量

3. 性能指标阈值
- 响应时间指标
- 错误率指标
- 吞吐量指标
- 各业务模块性能指标

## HTTP客户端工具

`utils/http.js` 提供了以下功能：

- GET请求：`client.get(path, params)`
- POST请求：`client.post(path, data, params)`
- PUT请求：`client.put(path, data, params)`
- DELETE请求：`client.delete(path, params)`
- 响应检查：自动检查状态码和响应时间
- 休眠功能：控制请求间隔

## 性能指标说明

### 关键性能指标

1. 响应时间
- P95 < 5000ms：95%的请求响应时间小于5秒
- P99 < 6000ms：99%的请求响应时间小于6秒
- 平均响应时间 < 4000ms
- 中位数响应时间 < 3000ms

2. 错误率
- 请求失败率 < 2%

3. 吞吐量
- 每秒请求数 > 30

4. 服务器处理时间
- 90%的服务器响应时间 < 2000ms

### 业务模块性能指标

各业务模块（帖子、评论、相册、待办事项）的性能要求：
- P95完成时间 < 3000ms
- 平均完成时间 < 2000ms
- 中位数完成时间 < 1500ms

## 测试结果分析

### 关注指标

1. 响应时间分布
- 查看P95、P99等百分位数据
- 分析响应时间的稳定性

2. 错误率分析
- 统计HTTP错误数量
- 分析错误类型和原因

3. 系统吞吐量
- 监控每秒请求数(RPS)
- 分析系统处理能力

4. 资源使用情况
- CPU使用率
- 内存消耗
- 网络带宽使用

### 优化建议

1. 如果响应时间超过阈值：
- 检查数据库查询优化
- 考虑增加缓存
- 评估服务器配置

2. 如果错误率过高：
- 排查系统错误日志
- 检查超时配置
- 评估并发连接数限制

3. 如果吞吐量不达标：
- 考虑增加服务器实例
- 优化代码性能
- 评估数据库性能

## 使用说明

### 环境准备

1. 安装k6
```bash
brew install k6  # MacOS
```

2. 安装依赖
```bash
npm install
```

### 运行测试

1. 执行负载测试
```bash
npm run test:load
```

2. 执行压力测试
```bash
npm run test:stress
```

3. 执行峰值测试
```bash
npm run test:spike
```

### 查看结果

测试完成后，k6会生成详细的测试报告，包含：
- 响应时间统计
- 请求成功/失败数
- 每秒请求数据
- 各业务模块性能数据

## 注意事项

1. 测试前准备
- 确保测试环境网络稳定
- 清理测试数据和缓存
- 准备足够的测试数据

2. 测试执行
- 避免在生产环境执行压力测试
- 监控系统资源使用情况
- 及时记录异常情况

3. 结果分析
- 对比历史测试数据
- 关注性能劣化趋势
- 制定性能优化方案